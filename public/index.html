<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Game Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--eton:#96c8a2;--eton-deep:#5a9a6d;--eton-pale:#e8f5ec;--eton-glow:rgba(150,200,162,0.4);--white:#fff;--gray-50:#fafafa;--gray-200:#e8e8ed;--gray-400:#86868b;--gray-500:#6e6e73;--gray-600:#1d1d1f;--black:#000;--shadow-soft:0 2px 40px rgba(0,0,0,0.04);--shadow-medium:0 8px 60px rgba(0,0,0,0.08);--shadow-strong:0 20px 80px rgba(0,0,0,0.12);--shadow-eton:0 8px 40px rgba(150,200,162,0.35)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',-apple-system,sans-serif;background:linear-gradient(180deg,var(--eton-pale) 0%,var(--white) 50%,var(--gray-50) 100%);color:var(--gray-600);min-height:100vh;line-height:1.5;-webkit-font-smoothing:antialiased}.ambient{position:fixed;top:-50%;left:-50%;width:200%;height:200%;pointer-events:none;z-index:0;background:radial-gradient(ellipse at 25% 15%,rgba(150,200,162,0.3) 0%,transparent 50%),radial-gradient(ellipse at 75% 70%,rgba(150,200,162,0.2) 0%,transparent 50%);animation:drift 25s ease-in-out infinite}@keyframes drift{0%,100%{transform:translate(0,0)}50%{transform:translate(2%,1%)}}.app{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:48px 24px}header{text-align:center;margin-bottom:40px;animation:fadeUp 1s cubic-bezier(0.16,1,0.3,1) 0.2s both}@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.logomark{width:72px;height:72px;margin:0 auto 28px;background:linear-gradient(145deg,var(--eton) 0%,var(--eton-deep) 100%);border-radius:20px;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-eton);position:relative}.logomark::before{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,rgba(255,255,255,0.35) 0%,transparent 100%);border-radius:20px 20px 0 0}.logomark span{font-family:Georgia,serif;font-size:32px;font-weight:600;color:var(--white);position:relative;z-index:1}header h1{font-size:2.75rem;font-weight:600;color:var(--black);letter-spacing:-0.035em;margin-bottom:10px}header p{font-size:1.1875rem;color:var(--gray-500)}.chat-container{width:100%;max-width:840px;flex:1;display:flex;flex-direction:column;background:rgba(255,255,255,0.85);backdrop-filter:blur(40px);border-radius:32px;border:1px solid rgba(255,255,255,0.9);box-shadow:var(--shadow-strong);overflow:hidden;animation:scaleUp 0.8s cubic-bezier(0.16,1,0.3,1) 0.4s both}@keyframes scaleUp{from{opacity:0;transform:scale(0.96) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}.messages{flex:1;overflow-y:auto;padding:44px;display:flex;flex-direction:column;gap:28px;min-height:480px}.welcome{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;animation:fadeUp 0.8s cubic-bezier(0.16,1,0.3,1) 0.8s both}.welcome-avatar{width:96px;height:96px;border-radius:50%;object-fit:cover;margin-bottom:32px;box-shadow:var(--shadow-medium);border:4px solid var(--white);outline:3px solid var(--eton);outline-offset:3px}.welcome h2{font-size:1.875rem;font-weight:600;color:var(--black);margin-bottom:14px}.welcome p{font-size:1.0625rem;color:var(--gray-500);max-width:400px;text-align:center;margin-bottom:40px}.suggestions{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;max-width:560px}.suggestion-btn{padding:14px 24px;background:var(--white);border:2px solid var(--gray-200);border-radius:100px;font-family:inherit;font-size:0.9375rem;font-weight:500;color:var(--gray-600);cursor:pointer;transition:all 0.35s cubic-bezier(0.16,1,0.3,1)}.suggestion-btn:hover{border-color:var(--eton);background:var(--eton);color:var(--white);transform:translateY(-4px);box-shadow:var(--shadow-eton)}.message{display:flex;gap:18px;max-width:88%;animation:messageIn 0.5s cubic-bezier(0.16,1,0.3,1) forwards}@keyframes messageIn{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}.message.user{align-self:flex-end;flex-direction:row-reverse}.message.assistant{align-self:flex-start}.avatar{width:48px;height:48px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.875rem;overflow:hidden}.message.user .avatar{background:linear-gradient(145deg,var(--eton) 0%,var(--eton-deep) 100%);color:var(--white);box-shadow:var(--shadow-eton)}.message.assistant .avatar{border:2px solid var(--eton);background:var(--white)}.message.assistant .avatar img{width:100%;height:100%;object-fit:cover}.bubble{padding:18px 22px;border-radius:24px;line-height:1.65;font-size:0.9375rem}.message.user .bubble{background:linear-gradient(145deg,var(--eton) 0%,var(--eton-deep) 100%);color:var(--white);border-bottom-right-radius:6px;box-shadow:var(--shadow-eton)}.message.assistant .bubble{background:var(--white);color:var(--gray-600);border-bottom-left-radius:6px;border:1px solid var(--gray-200);box-shadow:var(--shadow-soft)}.bubble p{margin-bottom:0.85em}.bubble p:last-of-type{margin-bottom:0}.signature{display:block;margin-top:18px;padding-top:16px;border-top:1px solid var(--gray-200);font-family:Georgia,serif;font-style:italic;color:var(--eton-deep)}.typing-dots{display:flex;gap:7px;padding:10px 0}.typing-dots span{width:11px;height:11px;background:linear-gradient(145deg,var(--eton) 0%,var(--eton-deep) 100%);border-radius:50%;animation:bounce 1.4s ease-in-out infinite}.typing-dots span:nth-child(2){animation-delay:0.16s}.typing-dots span:nth-child(3){animation-delay:0.32s}@keyframes bounce{0%,60%,100%{transform:translateY(0);opacity:0.35}30%{transform:translateY(-12px);opacity:1}}.cursor{display:inline;animation:blink 0.75s ease-in-out infinite;color:var(--eton)}@keyframes blink{0%,45%{opacity:1}50%,100%{opacity:0}}.input-area{padding:28px 32px 32px;background:linear-gradient(180deg,transparent 0%,rgba(150,200,162,0.06) 100%);border-top:1px solid var(--gray-200)}.input-wrapper{display:flex;gap:16px;align-items:flex-end}.input-field{flex:1}.input-field textarea{width:100%;padding:18px 22px;border:2px solid var(--gray-200);border-radius:22px;font-family:inherit;font-size:0.9375rem;resize:none;outline:none;transition:all 0.35s;background:var(--white);color:var(--gray-600)}.input-field textarea::placeholder{color:var(--gray-400)}.input-field textarea:focus{border-color:var(--eton);box-shadow:0 0 0 5px var(--eton-glow)}.send-btn{width:60px;height:60px;background:linear-gradient(145deg,var(--eton) 0%,var(--eton-deep) 100%);border:none;border-radius:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.35s;box-shadow:var(--shadow-eton)}.send-btn:hover:not(:disabled){transform:translateY(-4px) scale(1.03);box-shadow:0 16px 48px rgba(150,200,162,0.5)}.send-btn:disabled{opacity:0.5;cursor:not-allowed}.send-btn svg{width:26px;height:26px;fill:var(--white);transform:translateX(2px)}.status-bar{display:flex;align-items:center;justify-content:center;gap:10px;padding:16px;font-size:0.8125rem;font-weight:500;color:var(--gray-500);background:linear-gradient(180deg,rgba(150,200,162,0.12) 0%,rgba(150,200,162,0.06) 100%);border-bottom:1px solid rgba(150,200,162,0.2)}.status-dot{width:9px;height:9px;border-radius:50%;background:var(--eton);box-shadow:0 0 12px var(--eton-glow)}.status-bar.connecting .status-dot{background:#f59e0b;animation:pulse 1.5s ease-in-out infinite}.status-bar.error .status-dot{background:#ef4444}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}footer{margin-top:28px;text-align:center;animation:fadeUp 0.8s cubic-bezier(0.16,1,0.3,1) 0.6s both}footer p{font-size:0.875rem;color:var(--gray-400)}footer em{font-family:Georgia,serif;color:var(--eton-deep)}@media(max-width:640px){.app{padding:28px 16px}header h1{font-size:2rem}.chat-container{border-radius:24px}.messages{padding:28px 20px;min-height:380px}.message{max-width:92%}.welcome-avatar{width:76px;height:76px}.suggestions{gap:10px}.suggestion-btn{padding:11px 18px;font-size:0.875rem}.input-area{padding:20px 16px 24px}.send-btn{width:52px;height:52px;border-radius:16px}}
    </style>
</head>
<body>
    <div class="ambient"></div>
    <div class="app">
        <header>
            <div class="logomark"><span>E</span></div>
            <h1>Field Game Assistant</h1>
            <p>Understanding the Laws and umpiring decisions</p>
        </header>
        <div class="chat-container">
            <div class="status-bar" id="status">
                <span class="status-dot"></span>
                <span class="status-text">Ready</span>
            </div>
            <div class="messages" id="messages">
                <div class="welcome" id="welcome">
                    <img src="/ralph.png" alt="RDO-C" class="welcome-avatar" onerror="this.style.display='none'">
                    <h2>Good day</h2>
                    <p>I'm here to help you understand the Laws of the Field Game and make better umpiring decisions.</p>
                    <div class="suggestions">
                        <button class="suggestion-btn" onclick="askQuestion('What is a Rouge?')">What is a Rouge?</button>
                        <button class="suggestion-btn" onclick="askQuestion('Explain Sneaking')">Explain Sneaking</button>
                        <button class="suggestion-btn" onclick="askQuestion('When is a ball Rougeable?')">When is a ball Rougeable?</button>
                        <button class="suggestion-btn" onclick="askQuestion('What is Cornering?')">What is Cornering?</button>
                        <button class="suggestion-btn" onclick="askQuestion('When can you head the ball?')">Heading rules</button>
                    </div>
                </div>
            </div>
            <div class="input-area">
                <div class="input-wrapper">
                    <div class="input-field">
                        <textarea id="input" rows="2" placeholder="Ask about the Laws..." onkeydown="handleKeydown(event)"></textarea>
                    </div>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </div>
        </div>
        <footer><p><em>Floreat Etona</em></p></footer>
    </div>
    <script>
        let threadId=null,isLoading=false;
        function handleKeydown(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}}
        function askQuestion(t){document.getElementById('input').value=t;sendMessage()}
        function setStatus(t,c=''){const s=document.getElementById('status');s.className='status-bar '+c;s.querySelector('.status-text').textContent=t}
        function addMessage(c,u,tw=false){const w=document.getElementById('welcome');if(w)w.remove();const m=document.getElementById('messages'),d=document.createElement('div');d.className=`message ${u?'user':'assistant'}`;const av=u?'You':'<img src="/ralph.png" alt="R" onerror="this.parentElement.textContent=\'R\'">';if(tw&&!u){d.innerHTML=`<div class="avatar">${av}</div><div class="bubble"><span class="tw"></span><span class="cursor">|</span></div>`;m.appendChild(d);m.scrollTop=m.scrollHeight;const ts=d.querySelector('.tw'),cu=d.querySelector('.cursor'),fc=formatContent(c,true);let i=0;function type(){if(i<c.length){ts.textContent+=c.charAt(i);i++;m.scrollTop=m.scrollHeight;setTimeout(type,6)}else{ts.innerHTML=fc;cu.remove();m.scrollTop=m.scrollHeight}}type()}else{d.innerHTML=`<div class="avatar">${av}</div><div class="bubble">${formatContent(c,!u)}</div>`;m.appendChild(d);m.scrollTop=m.scrollHeight}}
        function formatContent(c,sig=false){let f=c.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');f='<p>'+f+'</p>';f=f.replace(/<p><\/p>/g,'');if(sig&&!c.includes('RDO-C')&&!c.includes('Best wishes'))f+='<span class="signature">— RDO-C</span>';return f}
        function showTyping(){const m=document.getElementById('messages'),d=document.createElement('div');d.className='message assistant';d.id='typing';d.innerHTML='<div class="avatar"><img src="/ralph.png" alt="R" onerror="this.parentElement.textContent=\'R\'"></div><div class="bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';m.appendChild(d);m.scrollTop=m.scrollHeight}
        function removeTyping(){const t=document.getElementById('typing');if(t)t.remove()}
        async function sendMessage(){const i=document.getElementById('input'),msg=i.value.trim();if(!msg||isLoading)return;isLoading=true;document.getElementById('sendBtn').disabled=true;i.value='';addMessage(msg,true);showTyping();setStatus('Consulting the Laws...','connecting');try{const r=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg,threadId})});const d=await r.json();if(d.error)throw new Error(d.error);threadId=d.threadId;removeTyping();addMessage(d.response,false,true);setStatus('Ready')}catch(e){removeTyping();addMessage(`I do apologise — there seems to be a technical difficulty: ${e.message}`,false);setStatus('Error','error')}isLoading=false;document.getElementById('sendBtn').disabled=false;i.focus()}
    </script>
</body>
</html>
